<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Base Software &mdash; Nukestar 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Nukestar 0.1 documentation" href="index.html" />
    <link rel="next" title="Hardware Maintainance Guide" href="maintenance.html" />
    <link rel="prev" title="User and Group Management" href="user_management.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="maintenance.html" title="Hardware Maintainance Guide"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="user_management.html" title="User and Group Management"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Nukestar 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="base-software">
<h1>Base Software<a class="headerlink" href="#base-software" title="Permalink to this headline">¶</a></h1>
<p>The software install guide is split between the host OS (base system) and the chroot environment
which is effectively the global &#8220;compute node&#8221; OS.</p>
<p>On the base system we will install:</p>
<ul class="simple">
<li>Torque+maui job scheduler</li>
</ul>
<p>In the chroot / compute node environment, the following software will be installed:</p>
<ul>
<li><p class="first">Torque</p>
</li>
<li><p class="first">Maui</p>
</li>
<li><p class="first">environment-modules</p>
</li>
<li><dl class="first docutils">
<dt>user specific software:</dt>
<dd><ul class="first last simple">
<li>mcnp</li>
<li>python packages</li>
<li>njoy</li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="section" id="base-os-software">
<h2>Base OS software<a class="headerlink" href="#base-os-software" title="Permalink to this headline">¶</a></h2>
<p>On the host OS, create a scratch setup/build folder somwhere:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#mkdir /setup</span>
<span class="c">#cd /setup</span>
</pre></div>
</div>
<p>Copy the build scripts from the <code class="docutils literal"><span class="pre">/bash</span></code> folder of this repo into the <code class="docutils literal"><span class="pre">/setup</span></code> folder.</p>
</div>
<div class="section" id="torque-maui">
<h2>Torque + Maui<a class="headerlink" href="#torque-maui" title="Permalink to this headline">¶</a></h2>
<p>Before the scripts can be executed, the source tarball for both Torque and Maui must be procured from the adaptivecomputing.com website.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#cd /setup</span>
<span class="c">#wget http://wpfilebase.s3.amazonaws.com/torque/torque-6.1.0.tar.gz</span>
<span class="c">#wget http://wpfilebase.s3.amazonaws.com/mauischeduler/maui-3.3.1.tar.gz</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In order to download the Maui software package, you must first create an account
on the adaptivecomputing.com website.</p>
</div>
<p>Install scripts for <a class="reference external" href="http://www.adaptivecomputing.com/products/open-source/torque-resource-manager/">Torque</a> and <a class="reference external" href="http://www.adaptivecomputing.com/products/open-source/maui/">Maui</a> can be found in the <code class="docutils literal"><span class="pre">/bash</span></code> folder of this repo.</p>
<p>Execute the torque and maui install script on the head node (host OS):</p>
<div class="highlight-python"><div class="highlight"><pre>#cp /root/nukecluster/bash/setup/install_pbs-head.sh \
/setup/.
#chmod +x install_pbs-head.sh
#./install_pbs-head.sh
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">WARNING: The install_pbs-head.sh convinience script may need to be adjusted slightly.
This script just installs the dependencies and
executes the commands required to install Torque and Maui on the head node.</p>
</div>
<p>For Torque/Maui install troubleshooting see: <a class="reference external" href="http://docs.adaptivecomputing.com/torque/6-1-0/adminGuide/help.htm">Torque_install</a> .</p>
</div>
<div class="section" id="configure-torque-maui">
<h2>Configure Torque/Maui<a class="headerlink" href="#configure-torque-maui" title="Permalink to this headline">¶</a></h2>
<p>Queue settings are located in: <code class="docutils literal"><span class="pre">/var/spool/pbs/server_priv/queues/.</span></code> by default.
The queue settings can be updated by modifying the <code class="docutils literal"><span class="pre">qconfig</span></code> file and
running the <code class="docutils literal"><span class="pre">updatequeue.sh</span></code> script included in this nukestar maintenence package.</p>
<p>PBS queueconfig documentation may be found here: <a class="reference external" href="http://docs.adaptivecomputing.com/torque/4-0-2/Content/topics/4-serverPolicies/queueConfig.htm">Qconfig</a>.</p>
<p>Maui settings are stored in <code class="docutils literal"><span class="pre">/var/spool/maui/maui.cfg</span></code>.  Documentation for this file may be found: <a class="reference external" href="http://docs.adaptivecomputing.com/maui/index.php">Maui_docs</a>.</p>
<p>The hostlist fo Toruqe/Maui is stored in: <code class="docutils literal"><span class="pre">/var/spool/pbs/server_priv/nodes</span></code> by default.  This file
must be modified to add new compute nodes to the cluster.</p>
</div>
</div>
<div class="section" id="chroot-compute-node-software">
<h1>Chroot / Compute Node Software<a class="headerlink" href="#chroot-compute-node-software" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal"><span class="pre">PBS_MOM</span></code> daemon provided by Torque must be installed on the compute nodes so that the <code class="docutils literal"><span class="pre">pbs_server</span></code>
and Maui scheduler can communicate with and schedule jobs on the compute nodes.</p>
<div class="section" id="install-pbs-mom-in-chroot-compute-nodes">
<h2>Install PBS_MOM in Chroot / Compute Nodes<a class="headerlink" href="#install-pbs-mom-in-chroot-compute-nodes" title="Permalink to this headline">¶</a></h2>
<p>The Torque install process on the head node will create
two important shell scripts (which are acutally binary blobs!).
Check that the following files exist:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#cat /setup/torque-6.1.0/torque-package-clients-linux-x86_64.sh</span>
<span class="c">#cat /setup/torque-6.1.0/torque-package-mom-linux-x86_64.sh</span>
</pre></div>
</div>
<p>Create a scratch directory in chroot:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#mkdir /srv/nukeroot/setup</span>
</pre></div>
</div>
<p>Copy the binary blob/torque shell scripts to the Chroot:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#cp /setup/torque-6.1.0/torque-package-clients-linux-x86_64.sh /srv/nukeroot/setup/.</span>
<span class="c">#cp /setup/torque-6.1.0/torque-package-mom-linux-x86_64.sh /srv/nukeroot/setup/.</span>
</pre></div>
</div>
<p>Chroot</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#chroot /srv/nukeroot</span>
</pre></div>
</div>
<p>Install <code class="docutils literal"><span class="pre">pbs_mom</span></code> and <code class="docutils literal"><span class="pre">trqauthd</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#&gt; cd /setup</span>
<span class="c">#&gt; chmod +x torque-package-mom-linux-x86_64.sh</span>
<span class="c">#&gt; chmod +x torque-package-clients-linux-x86_64.sh</span>
<span class="c">#&gt; ./torque-package-mom-linux-x86_64.sh --install</span>
<span class="c">#&gt; ./torque-package-clients-linux-x86_64.sh --install</span>
</pre></div>
</div>
<p>Startup trqauthd in the chroot:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#&gt;trqauthd</span>
</pre></div>
</div>
<p>Check to see if it works:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#&gt; qnodes</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">qnodes</span></code> should output the status of all nodes in the cluster.  See the users guide for how to submit jobs to the queue.</p>
</div>
</div>
<div class="section" id="torque-maui-systemd-scripts">
<h1>TORQUE / MAUI systemd scripts<a class="headerlink" href="#torque-maui-systemd-scripts" title="Permalink to this headline">¶</a></h1>
<p>On the head node we must start the <code class="docutils literal"><span class="pre">pbs_server</span></code>, <code class="docutils literal"><span class="pre">maui</span></code>, and <code class="docutils literal"><span class="pre">pbs_mom</span></code> daemons.  On the compute nodes,
only the <code class="docutils literal"><span class="pre">pbs_mom</span></code> service is required.  It is convinient to have these services automatically start on system boot up.
This can be achived by enabling the systemd startup scripts included with the Torque package.</p>
<div class="section" id="head-node">
<h2>Head Node<a class="headerlink" href="#head-node" title="Permalink to this headline">¶</a></h2>
<p>After a sucessful make and install of the Torque and Maui packages
navigate to <code class="docutils literal"><span class="pre">#/usr/lib/systemd/system/.</span></code>.</p>
<p>Check for the files <code class="docutils literal"><span class="pre">pbs_server.service</span></code>, <code class="docutils literal"><span class="pre">trqauthd.service</span></code> in this directory</p>
<p>Create the Maui systemd script:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#touch /usr/lib/systemd/system/maui.service</span>
</pre></div>
</div>
<p>Fill <code class="docutils literal"><span class="pre">/usr/lib/systemd/system/maui.service</span></code> with the following:</p>
<div class="highlight-python"><div class="highlight"><pre>[Unit]
Description=MAUI scheduler
Requires=network.target local-fs.target
Wants=rsyslog.target
After=trqauthd.service pbs_server.service network.target local-fs.target rsyslog.target

[Service]
Type=forking
User=root

# Let systemd guess the pid.
GuessMainPID=yes

# Start command
ExecStart=/usr/local/maui/sbin/maui

[Install]
WantedBy=multi-user.target
</pre></div>
</div>
<p>Enable Torque/Maui on boot with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#cd /usr/lib/systemd/system</span>
<span class="c">#systemctl enable trqauthd.service</span>
<span class="c">#systemctl enable pbs_server.service</span>
<span class="c">#systemctl enable maui.service</span>
</pre></div>
</div>
<p>Bring up Torque/Maui</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#service trqauthd start</span>
<span class="c">#service pbs_server start</span>
<span class="c">#service maui start</span>
</pre></div>
</div>
<p>Check the status of each service</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#systemctl status trqauthd.service</span>
<span class="c">#systemctl status pbs_server.service</span>
<span class="c">#systemctl status maui.service</span>
</pre></div>
</div>
</div>
<div class="section" id="compute-nodes-chroot">
<h2>Compute Nodes / chroot<a class="headerlink" href="#compute-nodes-chroot" title="Permalink to this headline">¶</a></h2>
<p>After the <code class="docutils literal"><span class="pre">torque-package-clients-linux-x86_64.sh</span></code> and.
<code class="docutils literal"><span class="pre">torque-package-mom-linux-x86_64.sh</span></code> scripts have been executed in the chroot environment
check that <code class="docutils literal"><span class="pre">/usr/lib/systemd/system/pbs_mom.service</span></code> exists in the chroot:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#&gt;cat /usr/lib/systemd/system/pbs_mom.service</span>
</pre></div>
</div>
<p>check that <code class="docutils literal"><span class="pre">/usr/lib/systemd/system/trqauthd.service</span></code> exists in the chroot:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#&gt;cat /usr/lib/systemd/system/trqauthd.service</span>
</pre></div>
</div>
<p>If this file was not created after executing <code class="docutils literal"><span class="pre">torque-package-mom-linux-x86_64.sh</span></code> something
went wrong with the Torque install.</p>
<p>Enable PBS_MOM daemon to start on compute node boot with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#&gt;cd /usr/lib/systemd/system</span>
<span class="c">#&gt;systemctl enable trqauthd.service</span>
<span class="c">#&gt;systemctl enable pbs_mom.service</span>
</pre></div>
</div>
<p>This concludes basic Torque/Maui setup.</p>
</div>
<div class="section" id="environment-modules">
<h2>Environment Modules<a class="headerlink" href="#environment-modules" title="Permalink to this headline">¶</a></h2>
<p>Install the environment-modules package in chroot:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#&gt;apt-get install environment-modules</span>
</pre></div>
</div>
<p>Then update the contents of <code class="docutils literal"><span class="pre">#&gt;/etc/bash.bashrc</span></code></p>
<div class="highlight-python"><div class="highlight"><pre>case &quot;$0&quot; in
          -sh|sh|*/sh)  modules_shell=sh ;;
       -ksh|ksh|*/ksh)  modules_shell=ksh ;;
       -zsh|zsh|*/zsh)  modules_shell=zsh ;;
    -bash|bash|*/bash)  modules_shell=bash ;;
esac
module() { eval `/usr/bin/modulecmd $modules_shell $*`; }
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Base Software</a><ul>
<li><a class="reference internal" href="#base-os-software">Base OS software</a></li>
<li><a class="reference internal" href="#torque-maui">Torque + Maui</a></li>
<li><a class="reference internal" href="#configure-torque-maui">Configure Torque/Maui</a></li>
</ul>
</li>
<li><a class="reference internal" href="#chroot-compute-node-software">Chroot / Compute Node Software</a><ul>
<li><a class="reference internal" href="#install-pbs-mom-in-chroot-compute-nodes">Install PBS_MOM in Chroot / Compute Nodes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#torque-maui-systemd-scripts">TORQUE / MAUI systemd scripts</a><ul>
<li><a class="reference internal" href="#head-node">Head Node</a></li>
<li><a class="reference internal" href="#compute-nodes-chroot">Compute Nodes / chroot</a></li>
<li><a class="reference internal" href="#environment-modules">Environment Modules</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="user_management.html"
                        title="previous chapter">User and Group Management</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="maintenance.html"
                        title="next chapter">Hardware Maintainance Guide</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/software_setup.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="maintenance.html" title="Hardware Maintainance Guide"
             >next</a> |</li>
        <li class="right" >
          <a href="user_management.html" title="User and Group Management"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Nukestar 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, william gurecky.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>